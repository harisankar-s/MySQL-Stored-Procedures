CREATE DEFINER=`cmsuser`@`localhost` PROCEDURE `Populate_MonthUserWiseCount`()
BEGIN

DELETE FROM RPT_PROJECTION_MON_COUNT_USER WHERE CDR_DATE BETWEEN DATE_FORMAT(DATE_ADD(DATE_ADD(CURDATE(),INTERVAL -1 DAY),INTERVAL -5 MONTH),'%Y-%M-01') AND LAST_DAY(DATE_ADD(DATE_ADD(CURDATE(),INTERVAL -1 DAY),INTERVAL -5 MONTH));

DELETE FROM RPT_PROJECTION_MON_COUNT_USER WHERE CDR_DATE BETWEEN DATE_ADD(CURDATE(),INTERVAL -10 DAY) AND DATE_ADD(CURDATE(),INTERVAL -1 DAY);

INSERT INTO RPT_PROJECTION_MON_COUNT_USER (CDR_DATE,USER_ID,SUBMIT_COUNT) SELECT CDR_DATE, USER_ID, SUM(SUBMIT_COUNT) FROM RPT_SUBMIT_DELIVERY_FACT_IB WHERE STATUS_CODE=0 AND CDR_DATE BETWEEN DATE_ADD(CURDATE(),INTERVAL -10 DAY) AND DATE_ADD(CURDATE(),INTERVAL -1 DAY)  GROUP BY CDR_DATE,USER_ID;

INSERT INTO RPT_PROJECTION_MON_COUNT_USER (CDR_DATE,USER_ID,DELIVERY_COUNT) SELECT CDR_DATE,USER_ID,SUM(DELIVERY_COUNT) FROM RPT_SUBMIT_DELIVERY_FACT_IB WHERE STATUS_CODE=0 AND DEL_STATUS=0 AND CDR_DATE BETWEEN DATE_ADD(CURDATE(),INTERVAL -10 DAY) AND DATE_ADD(CURDATE(),INTERVAL -1 DAY)  GROUP BY CDR_DATE,USER_ID;
END 